<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (Ø­ØªÙ‰ 2GB)</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ù‚Ø©</h1>
        <p class="subtitle">Ø®Ø¯Ù…Ø© Ù…Ø¬Ø§Ù†ÙŠØ© Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© (ØµÙˆØ±ØŒ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§ØªØŒ Ù…Ù„ÙØ§Øª) ØªØµÙ„ Ø¥Ù„Ù‰ 2 Ø¬ÙŠØ¬Ø§Ø¨Ø§ÙŠØª.</p>
        
        <form id="uploadForm">
            <input type="file" id="fileInput" name="file" required>
            <button type="submit" id="uploadButton">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¢Ù†</button>
        </form>

        <div id="statusMessage" class="status"></div>
        <div id="progressBarContainer">
            <div id="progressBar"></div>
        </div>
        <div id="downloadLinkContainer">
            <a id="downloadLink" href="#" target="_blank">Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</a>
        </div>
    </div>

    <script>
        const API_URL = "https://deno-telegram-api.marwanmohamed-code.deno.net/upload_file";
        
        const uploadForm = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const uploadButton = document.getElementById('uploadButton');
        const statusMessage = document.getElementById('statusMessage');
        const progressBar = document.getElementById('progressBar');
        const downloadLinkContainer = document.getElementById('downloadLinkContainer');
        const downloadLink = document.getElementById('downloadLink');

        downloadLinkContainer.style.display = 'none';

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (fileInput.files.length === 0) {
                statusMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù„Ù„Ø±ÙØ¹.';
                statusMessage.className = 'status error';
                return;
            }

            const file = fileInput.files[0];
            const fileSizeMB = file.size / (1024 * 1024);
            const MAX_SIZE_MB = 2048; // 2 GB limit

            if (fileSizeMB > MAX_SIZE_MB) {
                statusMessage.textContent = `Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù (${fileSizeMB.toFixed(2)} MB) ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡ (2 GB).`;
                statusMessage.className = 'status error';
                return;
            }

            uploadButton.disabled = true;
            statusMessage.textContent = 'Ø¨Ø¯Ø¡ Ø§Ù„Ø±ÙØ¹...';
            statusMessage.className = 'status loading';
            progressBar.style.width = '0%';
            downloadLinkContainer.style.display = 'none';

            try {
                const formData = new FormData();
                formData.append('file', file);

                const xhr = new XMLHttpRequest();
                xhr.open('POST', API_URL);

                // ØªØªØ¨Ø¹ ØªÙ‚Ø¯Ù… Ø§Ù„Ø±ÙØ¹
                xhr.upload.addEventListener('progress', (e) => {
                    if (e.lengthComputable) {
                        const percent = (e.loaded / e.total) * 100;
                        progressBar.style.width = percent.toFixed(2) + '%';
                        statusMessage.textContent = `Ø¬Ø§Ø±Ù Ø§Ù„Ø±ÙØ¹: ${percent.toFixed(0)}%`;
                    }
                });

                xhr.onload = () => {
                    uploadButton.disabled = false;
                    try {
                        const response = JSON.parse(xhr.responseText);
                        if (response.success) {
                            statusMessage.textContent = 'âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ø±Ø§Ø¨Ø· Ø¬Ø§Ù‡Ø² Ù„Ù„ØªØ­Ù…ÙŠÙ„.';
                            statusMessage.className = 'status success';
                            downloadLink.href = response.url;
                            downloadLinkContainer.style.display = 'block';
                            progressBar.style.width = '100%';
                        } else {
                            statusMessage.textContent = `âŒ ÙØ´Ù„ Ø§Ù„Ø±ÙØ¹: ${response.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ.'}`;
                            statusMessage.className = 'status error';
                        }
                    } catch (error) {
                         statusMessage.textContent = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±: ${xhr.status} ${xhr.statusText}`;
                         statusMessage.className = 'status error';
                    }
                };
                
                xhr.onerror = () => {
                     uploadButton.disabled = false;
                     statusMessage.textContent = 'âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø´Ø¨ÙƒØ© Ø£Ùˆ Ø§Ù„Ø³ÙŠØ±ÙØ±.';
                     statusMessage.className = 'status error';
                };

                xhr.send(formData);

            } catch (error) {
                uploadButton.disabled = false;
                statusMessage.textContent = `âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ${error.message}`;
                statusMessage.className = 'status error';
            }
        });
    </script>
</body>
</html>
